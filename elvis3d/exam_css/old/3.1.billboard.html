<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=no">

    <title> billboard  </title>

    <!--<link rel="stylesheet" href="../libs/ramb3d/gbox3d.three.css"/>-->


    <script src='../libs/jquery-1.9.1.min.js'></script>

    <script src='../libs/threejs/three.js'></script>

    <script src='../libs/threejs/CSS3DRenderer.js'></script>
    <script src='../libs/ramb3d/core.js'></script>

    <script>


        $(function() {

            var Smgr = new ramb3d.scene.SceneManager();

            var hyuna_plane = ramb3d.util.createPlane({

                width : 200,
                height : 300,
                texture : '../res/hyuna.jpg',
                parent : Smgr.scene,
                position: new THREE.Vector3(0,150,0)

            });

            var suji_plane = ramb3d.util.createPlane({

                width : 400,
                height : 600,
                texture : '../res/suji.jpg',
                parent : Smgr.scene

            });

            suji_plane.rotation.x = THREE.Math.degToRad(90);

            var dummy_lookat = ramb3d.util.createDummy({
                parent : Smgr.scene,
                position :new THREE.Vector3(0,0,0)
            });

            var dummy_eye = ramb3d.util.createDummy({
                position :Smgr.camera.position
            });

            Smgr.scene.add(dummy_lookat);

            dummy_lookat.add(dummy_eye)


            Smgr.updateAll();

            //이벤트처리
            (function(control_obj) {

                var canvas_dom = Smgr.renderer.domElement;
                canvas_dom.addEventListener( 'mousedown', onDocumentMouseDown, false );

                window.addEventListener( 'resize', onWindowResize, false );

                function onWindowResize() {

                    Smgr.updateAll({
                        resize : {
                            width :  window.innerWidth,
                            height : window.innerHeight
                        }
                    });

                }

                function onDocumentMouseDown( event ) {

                    event.preventDefault();

                    canvas_dom.addEventListener( 'mousemove', onDocumentMouseMove, false );
                    canvas_dom.addEventListener( 'mouseup', onDocumentMouseUp, false );

                }

                function onDocumentMouseMove( event ) {

                    var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
                    var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;


                    //시점 기준 y축 고정 방식의(fps형) 카메라 제어 할때 쓰이는 방식
                    //오브잭트에 적용 시키면 트랙볼임..
                    control_obj.eulerOrder = 'YXZ';
                    control_obj.rotation.y += movementX * 0.01;
                    control_obj.rotation.x -= movementY * 0.01;

                    //매트릭스 css3 적용
                    control_obj.updateMatrix();


                    //씬노드에 있는 노드들의 월드행렬들을 최신으로 모두 갱신해주기
                    Smgr.scene.updateMatrixWorld(true);

                    //월드 좌표구하기
                    var worldPos = new THREE.Vector3(0,0,0);
                    worldPos.getPositionFromMatrix(dummy_eye.matrixWorld);
                    Smgr.camera.position.copy(worldPos);
                    Smgr.camera.lookAt( control_obj.position);


                    var lookatVect = new THREE.Vector3();
                    lookatVect.subVectors(Smgr.camera.position,new THREE.Vector3(0,0,0));
                    lookatVect.normalize();

                    //회전 각도 구하기
                    var angle = new THREE.Vector3();
                    angle.y = THREE.Math.radToDeg(Math.atan2(lookatVect.x, lookatVect.z));
                    if (angle.y < 0) {
                        angle.y += 360
                    }
                    if (angle.y >= 360) {
                        angle.y -= 360
                    }

                    console.log(lookatVect.x +',' +lookatVect.z + ',' +angle.y);

                    hyuna_plane.rotation.y = THREE.Math.degToRad(angle.y);



                    Smgr.updateAll();

                    //renderer.render( scene, camera );
                }

                function onDocumentMouseUp( event ) {

                    canvas_dom.removeEventListener( 'mousemove', onDocumentMouseMove );
                    canvas_dom.removeEventListener( 'mouseup', onDocumentMouseUp );
                }

            })(dummy_lookat);

        });


    </script>

</head>

<body style="margin: 0px;">

</body>
</html>